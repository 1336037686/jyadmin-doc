# 数据库规范



| 版本   | 时间       | 修改点 | 修改人  |
| :----- | :--------- | :----- | :------ |
| v1.0.0 | 2022-05-25 | 编写   | LGX_TvT |
| -      | -          | -      | -       |



## 1、命名规范

- 采用小写字母、数字（通常不需要）和下划线组成。禁止使用’-’，命名简洁、含义明确。



- 数据库表名、列名和索引名应该使用小写字母，单词之间用下划线分隔。



- 表名应该使用单数形式，例如“user”而不是“users”。



- 列名应该具有明确的含义，尽量避免使用缩写或简写。



- 不要使用 MySQL 中的保留字作为表名、列名或索引名。



- 命名长度尽量控制在30个字符以内。



表名常用前缀，用于区分不同的表类型

| 类型                 | 前缀       | 说明     |
| -------------------- | ---------- | -------- |
| 业务表               | tb_        |          |
| 关系表               | tr_        |          |
| 历史表               | th_        |          |
| 统计表               | ts_        |          |
| 日志表               | tl_xx_log  |          |
| 系统表、字典表、码表 | sys_       |          |
| 临时表               | tmp_       | 禁止使用 |
| 备份表               | bak_xx_ymd |          |
| 视图                 | view_      | 避免使用 |



## 2、存储引擎

存储引擎使用默认的`InnoDB`引擎。使用`InnoDB`引擎可支持事务、支持行级锁、更好的恢复性、在高并发下性能更好。



## 3、字符集

- 数据库和表的字符集统一，尽量使用`utf8mb4`（根据业务需求）。统一字符集可以避免由于字符集转换产生的乱码，不同的字符集进行比较前需要进行转换会造成索引失效。



- 除非特殊情况，禁止建表指定字符集（采用库默认字符集），降低出现字符集不统一导致性能问题的风险。



- 无特殊要求，禁止指定表COLLATE。COLLATE主要的作用是排序的规则以及检索的规则，utf8字符集默认的是 utf8_general_ci ，utf8mb4字符集默认的是utf8mb4_general_ci，结尾的ci意思是不区分大小写。



## 4、字段设计

- **所有表**和**字段**都需要添加**注释**，使用comment从句添加表和列的备注，从一开始就进行数据字典的维护。



- 尽量控制单表数据量的大小，建议控制在500万以内。



- 谨慎使用MySQL分区表。



- 禁止使用外键约束。



- 使用适当的数据类型和长度，以避免浪费空间和降低查询效率。例如，使用 INT 类型存储一个只需要 0 或 1 的布尔值是不合适的。



- 对于经常使用的查询，应该创建索引来提高查询效率。但是要注意不要过度使用索引，因为它会降低插入和更新的性能。



- 基础表需要添加五个基础字段，create_by 创建人、create_time 创建时间、update_by 更新人、update_time 更新时间、is_deleted 是否删除。



- 关系表（tr_）需要添加两个基础字段，create_by 创建人、create_time 创建时间。



## 5、索引设计规范

- 创建表一定要有主键（PRIMARY KEY），推荐使用雪花。



- 限制每张表上的索引数量。



- 尽量把字段长度小的列放在联合索引的最左侧（因为字段长度越小，一页能存储的数据量越大，IO性能也就越好）。



- 使用最频繁的列放到联合索引的左侧（这样可以比较少的建立一些索引）。



- 避免建立冗余索引和重复索引---因为这样会增加查询优化器生成执行计划的时间。



- 定要在表与表之间的关联键上建立索引。



## 6、SQL开发规划

- 建议使用预编译语句进行数据库操作。



- 避免数据类型的隐式转换，隐式转换会导致索引失效。如：select name,phone from customer where id = '111'。



- 充分利用表上已经存在的索引。



- 避免使用双%号的查询条件，如a like '%123%'，（如果无前置%,只有后置%，是可以用到列上的索引的）。



- 在明显不会有重复值时使用**UNION ALL**而不是UNION。



- WHERE从句中禁止对列进行函数转换和计算。



- 拆分复杂的大SQL为多个小SQL。



- 避免使用 SELECT * 查询所有列，应该只查询需要的列。



- 在插入和更新数据时，应该验证数据的有效性和完整性，以避免错误数据的插入或更新。





> 参考文献
>
> 【熬夜肝了】一篇数据库规范，你应该用的上 https://juejin.cn/search?query=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%84%E8%8C%83&type=0