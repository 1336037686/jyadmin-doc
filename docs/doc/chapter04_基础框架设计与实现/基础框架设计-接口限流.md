# 基础框架设计-接口限流

<br/>

| 版本   | 时间       | 修改点 | 修改人  |
| :----- | :--------- | :----- | :------ |
| v1.0.0 | 2022-05-25 | 编写   | LGX_TvT |
| -      | -          | -      | -       |

<br/>

## 1、概述



在构建和维护网络服务中，实现接口限流（Rate Limiting）是一项关键技术，它对保持系统稳定性，提高服务质量和防止资源滥用有着重要的作用。

以下是实现接口限流的主要原因：

1. **防止服务过载**：如果接口请求的速度超过了服务处理的能力，会导致服务过载，进而可能导致服务不可用或响应时间过长。通过限流，可以防止这种情况的发生，保持服务的稳定运行。
2. **资源的公平使用**：限流也可以防止部分用户或者客户端占用过多的资源，确保所有用户或者客户端都能公平地使用资源。
3. **保护后端服务**：如果后端服务（如数据库或内部微服务）不能处理大量并发请求，那么限流可以防止后端服务被压垮。
4. **防止恶意攻击**：例如，拒绝服务攻击（DoS）或分布式拒绝服务攻击（DDoS）就是通过大量的请求来尝试让服务不可用。限流可以有效地防止此类攻击。

综上所述，接口的限流的实现是为了保持服务的稳定性，提高服务质量，防止资源的滥用。无论是面对意外的流量峰值，还是故意的恶意攻击，限流都是一种有效的保护手段。



## 2、接口限流的实现方式

实现接口限流主要有以下几种方法：

1. **使用Spring Cloud Gateway的RequestRateLimiter**：Spring Cloud Gateway提供了RequestRateLimiter filter，它可以对请求进行限流。你可以设置令牌桶中的令牌数，每次请求消耗的令牌数等参数来控制限流的行为。

2. **使用Guava的RateLimiter**：Guava提供了一个RateLimiter类，它使用令牌桶算法来进行限流。

3. **使用Bucket4j**：Bucket4j是一个基于Java的令牌桶实现库，它提供了一种简单、易于使用的API来创建和使用令牌桶。

4. **使用Redis+Lua脚本进行限流**：你可以在Redis中为每个接口创建一个计数器，并使用Lua脚本来进行原子操作，以此来实现接口的限流。

5. **使用注解实现限流**：你可以创建一个自定义注解，例如@RateLimit，然后在需要限流的接口上使用这个注解。再创建一个拦截器或者AOP切面来拦截这些接口的请求，根据注解的参数进行限流。



在jyadmin中使用第4、第5种方案相结合的方式实现接口的限流。



